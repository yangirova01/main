import streamlit as st
import matplotlib.pyplot as plt
import numpy as np

st.title("Визуализация участка по координатам")
st.markdown("Введите координаты в формате `[[X1, Y1], [X2, Y2], ...]`")

# Поле для ввода координат
coord_input = st.text_area(
    "Координаты участка",
    value="""[
    [5470588.79254556, 7517329.14918596],
    [5470558.74615099, 7517283.63207208],
    [5470568.90366933, 7517276.34205487],
    [5470578.192469, 7517269.62251705],
    [5470592.45919079, 7517290.97717859],
    [5470591.46521123, 7517302.12980881],
    [5470593.47552749, 7517305.23896183],
    [5470593.44056685, 7517305.57692839],
    [5470602.24724352, 7517319.45290543],
    [5470602.63759289, 7517319.39893184],
    [5470602.97562822, 7517319.93194058],
    [5470600.31627647, 7517321.64350201],
    [5470588.79254556, 7517329.14918596]
]""",
    height=300,
)

try:
    # Преобразуем строку в список координат
    coords = eval(coord_input)  
    coords = np.array(coords)  

    # Строим график
    fig, ax = plt.subplots(figsize=(10, 8))
    ax.plot(coords[:, 0], coords[:, 1], 'b-', linewidth=2)  
    ax.plot(coords[:, 0], coords[:, 1], 'ro')  

    # Подписываем вершины
    for i, (x, y) in enumerate(coords):
        ax.text(x, y, str(i + 1), fontsize=12, ha='right')

    ax.set_title("Визуализация участка")
    ax.set_xlabel("Координата X")
    ax.set_ylabel("Координата Y")
    ax.grid(True)
    ax.axis('equal')  # Сохраняем пропорции

    # Выводим график в Streamlit
    st.pyplot(fig)

except Exception as e:
    st.error(f"Ошибка: {e}. Проверьте формат ввода!")

# Дополнительная информация
st.markdown("---")
st.markdown("**Примеры координат для теста:**")
st.code("""
# Треугольник
[[5470500, 7517000], [5470600, 7517000], [5470550, 7517100], [5470500, 7517000]]

# Прямоугольник
[[5470400, 7517200], [5470400, 7517300], [5470500, 7517300], [5470500, 7517200], [5470400, 7517200]]
""")
